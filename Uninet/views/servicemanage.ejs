<!doctype html>
<!-- Service Manage Page -->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <title> UniNet Express Lane Services </title>
  <!-- core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/font-awesome.min.css" rel="stylesheet">    
  <link href="css/animate.min.css" rel="stylesheet">
  <link href="css/owl.carousel.css" rel="stylesheet">
  <link href="css/owl.transitions.css" rel="stylesheet">
  <link href="css/prettyPhoto.css" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
  <link href="css/responsive.css" rel="stylesheet">
  <link href="css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="css/jquery-ui.min.css" rel="stylesheet">
  <link href="css/datepicker.css" rel="stylesheet">
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->    

  <!-- Alternative Style -->
  <!-- <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css"> -->

  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/mousescroll.js"></script>
  <script src="js/smoothscroll.js"></script>
  <script src="js/jquery.prettyPhoto.js"></script>
  <script src="js/jquery.isotope.min.js"></script>
  <script src="js/jquery.inview.min.js"></script>
  <script src="js/wow.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/jquery.dataTables.min.js"></script> 
  <script src="js/jquery-ui.min.js" ></script>

  <!-- <link rel="shortcut icon" href="images/ico/favicon.ico"> -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57-precomposed.png">

  <script>
    function checkForm(form){
      mac = /^([0-9a-fA-F][0-9a-fA-F]:){5}([0-9a-fA-F][0-9a-fA-F])$/;  
      if(!mac.test(form.resourceString1.value)) {  
        //alert("Error: Source MAC Address Is Error!");
        document.getElementById("alert").className = "alert alert-danger";
        document.getElementById('alert').innerHTML = "<strong>Error: Source MAC Address Not Correct!</strong>";
        form.resourceString1.focus();
        return false;  
      }
      if(!mac.test(form.resourceString2.value)) {  
        document.getElementById("alert").className = "alert alert-danger";
        document.getElementById('alert').innerHTML = "<strong>Error: Destination MAC Address Not Correct!</strong>";
        form.resourceString2.focus();
        return false;  
      }

      ip = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;
      if(!ip.test(form.IP1.value)) {  
        document.getElementById("alert").className = "alert alert-danger";
        document.getElementById('alert').innerHTML = "<strong>Error: Source IP Address Not Correct!</strong>";
        form.IP1.focus();
        return false;  
      }
      if(!ip.test(form.IP2.value)) {  
        document.getElementById("alert").className = "alert alert-danger";
        document.getElementById('alert').innerHTML = "<strong>Error: Destination IP Address Not Correct!</strong>";
        form.IP2.focus();
        return false;
      }   
    }
  </script>  
</head>
<body id="home" class="homepage">

  <header id="header">
    <nav id="main-menu" class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">          
          <div class="navbar-brand">
            <a href="/">
              <img class="hidden-xs" src="uninet_navbar.gif" style="display:inline-block; height:60px" alt="logo">&nbsp;&nbsp;&nbsp;
              <font class="hidden-xs" style="color: grey"><font style="color: darkblue">UniNet</font> Express Lane Services</font>
              <font class="visible-xs" style="color: grey;margin-top: -1px"><font style="color: darkblue">UniNet</font> Express Lane Services</font>
            </a>
          </div>

          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
          </button>          
        </div>
        <% if(user.role===1){%>
          <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
              <li class="scroll"><a href="/">Home</a></li>
              <li class="scroll"><a href="/#about">About</a></li>
              <li class="scroll"><a href="/status">Status</a></li>
              <li class="scroll"><a href="/user">User Management</a></li>
              <li class="scroll"><a href="/emailmanage">Email Management</a></li>
              <li class="scroll active"><a href="/servicemanage">Service Management</a></li>
              <li class="scroll"><a href="/globus">Globus Service</a></li>
            </ul>
          </div>
        <% } %>
      </div><!--/.container-->
    </nav>
  </header>

  <section id="status">
    <div id="container"> 
      <div class="section-header">
        <h2 class="section-title text-center wow fadeInDown">Service Management</h2>
          <p class="text-center wow fadeInDown">การจัดการบริการของผู้ใช้</p>
      </div>
    </div>
  </section>

  <section id="email_template" class="wow fadeIn">
    <div class="container">
      <div class="row">	    
        <div class="features">
        	
          <ul class="nav nav-tabs">
        	  <li class="active"><a data-toggle="tab" href="#all_service">All Services</a></li>
        	  <li><a data-toggle="tab" href="#state">Services State</a></li>
            <li><a data-toggle="tab" href="#history">History Logs</a></li>
        	</ul>

        	<div class="tab-content">
        	  <div id="all_service" class="tab-pane fade in active">
          		
              <table id="servicesrequest" class="table table-striped">
                <thead>
                  <tr bgcolor="#1E90FF">
                    <td colspan="8"><center><label><font color="white">Services Requested</font></label></center></td>
                  </tr>
                  <tr>
                    <th>Username</th>
                    <th>Source MAC</th>
                    <th>Destination MAC</th>
                    <th>Source IP</th>
                    <th>Destination IP</th>
            		    <th>Start Time</th>
                    <th>End Time</th>
            		    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% if(request.length) {
                    for(var i = 0;i < request.length;i++) { %>
                    <tr>
                      <td><%=request[i].username%></td>
                      <td><%=request[i].resourceString1%></td>
                      <td><%=request[i].resourceString2%></td>
                      <td><%=request[i].IP1%></td>
                      <td><%=request[i].IP2%></td>
              	      <td><%=request[i].startTime%></td>
                      <td><%=request[i].endTime%></td>
              		    <td>  
                        <div class="dropdown">  
                          <button class="btn btn-default btn-md dropdown-toggle dropdown-menu-right" type="button" data-toggle="dropdown"><span class="fa fa-navicon" aria-hidden="true"></span> Action</button>
                          <ul class="dropdown-menu">
                            <li><a data-toggle="modal" href="#AcceptModal<%=request[i].said%>"><span class="fa fa-check" aria-hidden="true"></span> Accept</a></li>
                            <li><a data-toggle="modal" href="#RequestModal<%=request[i].said%>"><span class="fa fa-close" aria-hidden="true"></span> Decline</a></li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                    <% } 
                  } %>
      	        </tbody>
      	      </table>
  			      
              <hr> 
              <!-- modal hidden -->

        	    <table id="servicesapprove" class="table table-striped">
                <thead>
                  <tr bgcolor="#2979FF">
                    <td colspan="8"><center><label><font color="white">Services Approved</font></label></center></td>
                  </tr>
                  <tr>
                    <th>Username</th>
                    <th>Source MAC</th>
                    <th>Destination MAC</th>
                    <th>Source IP</th>
                    <th>Destination IP</th>
            		    <th>Start Time</th>
                    <th>End Time</th>
            		    <th>Action</th>
                  </tr>
                </thead>
                <tbody>  
                  <% if(approve.length){ 
                    for(var i = 0;i < approve.length;i++) { %>
                    <tr>
                      <td><%=approve[i].username%></td>
                      <td><%=approve[i].resourceString1%></td>
                      <td><%=approve[i].resourceString2%></td>
                      <td><%=approve[i].IP1%></td>
                      <td><%=approve[i].IP2%></td>
              	      <td><%=approve[i].startTime%></td>
                      <td><%=approve[i].endTime%></td>
              		    <td>
                        <div class="dropdown">
                          <button class="btn btn-default btn-md dropdown-toggle dropdown-menu-right" type="button" data-toggle="dropdown"><span class="fa fa-navicon" aria-hidden="true"></span> Action</button>
                          <ul class="dropdown-menu">
                            <li><a data-toggle="modal" href="#ApproveCancelModal<%=approve[i].said%>"><span class="fa fa-close" aria-hidden="true"></span> Delete</a></li>
                          </ul>
                      </div></td>
                    </tr>
                    <% }
                  } %>
            	  </tbody>
            	</table>

  		        <hr>
              <!-- modal hidden -->

              <table id="activeservices" class="table table-striped">
          	    <thead>
                  <tr bgcolor="#2962FF">
                    <td colspan="8"><center><label><font color="white">Active Services</font></label></center></td>
                  </tr>
                  <tr>
                    <th>Username</th>
                    <th>Source MAC</th>
                    <th>Destination MAC</th>
                    <th>Source IP</th>
                    <th>Destination IP</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% if(active.length){              
                    for(var i = 0;i < active.length;i++) { %>
                      <tr>
                        <td><%=active[i].username%></td>
                        <td><%=active[i].resourceString1%></td>
                        <td><%=active[i].resourceString2%></td>
                        <td><%=active[i].IP1%></td>
                        <td><%=active[i].IP2%></td>
                		    <td><%=active[i].startTime%></td>
                        <td><%=active[i].endTime%></td>
                        <td>
                          <div class="dropdown">
                            <button class="btn btn-default btn-md dropdown-toggle dropdown-menu-right" type="button" data-toggle="dropdown"><span class="fa fa-navicon" aria-hidden="true"></span> Action</button>
                            <ul class="dropdown-menu">
                              <li><a data-toggle="modal" href="#EditActiveModal<%=active[i].apid%>"><span class="fa fa-pencil-square-o" aria-hidden="true"></span> Edit</a></li>
                              <li><a data-toggle="modal" href="#CancleActiveModal<%=active[i].apid%>"><span class="fa fa-close" aria-hidden="true"></span> Delete</a></li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                    <% }
                  } %>
                </tbody>
              </table>

              <hr> 
              <!-- modal hidden -->

              <p align="center">
                <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#AddModal "><span class="fa fa-plus" aria-hidden="true"></span> Add New Express</button>
              </p>              
            </div>

            <div id="state" class="tab-pane fade">
          	  <table id="statetable" class="table table-striped">
                <thead>
                  <tr bgcolor="#1E90FF">
                    <td colspan="8"><center><label><font color="white">Services State</font></label></center></td>
                  </tr>
                  <tr>
                    <th>Username</th>
                    <th>Source MAC</th>
                    <th>Destination MAC</th>
                    <th>Source IP</th>
                    <th>Destination IP</th>
            	      <th>Start Time</th>
                    <th>End Time</th>
          		      <th>Type</th>
                  </tr>
                </thead>
                <tbody>
                  <% if(state.length){             
                    for(var i = 0;i < state.length;i++) { %>
                    <tr>
                      <td><%=state[i].username%></td>
                      <td><%=state[i].resourceString1%></td>
                      <td><%=state[i].resourceString2%></td>
                      <td><%=state[i].IP1%></td>
                      <td><%=state[i].IP2%></td>
              	      <td><%=state[i].startTime%></td>
                      <td><%=state[i].endTime%></td>
                      <td><%=state[i].nameE%></td>
                    </tr>                   
                    <%}
                  }%>
                </tbody>
              </table>
            </div>

        	  <div id="history" class="tab-pane fade">
          	  <table id="historytable" class="table table-striped">
                <thead>
                  <tr bgcolor="#1E90FF">
                    <td colspan="9"><center><label><font color="white">Services History Logs</font></label></center></td>
                  </tr>
                  <tr>
                    <th>Username</th>
                    <th>Source MAC</th>
                    <th>Destination MAC</th>
                    <th>Source IP</th>
                    <th>Destination IP</th>
            	      <th>Start Time</th>
                    <th>End Time</th>
                    <th>Timestamp</th>
          		      <th>Type</th>
                  </tr>
                </thead>
                <tbody>
                  <% if(history.length) {             
                    for(var i = 0;i < history.length;i++) { %>
                    <tr>
                      <td><%=history[i].username%></td>
                      <td><%=history[i].resourceString1%></td>
                      <td><%=history[i].resourceString2%></td>
                      <td><%=history[i].IP1%></td>
                      <td><%=history[i].IP2%></td>
              	      <td><%=history[i].startTime%></td>
                      <td><%=history[i].endTime%></td>
                      <td><%=history[i].timestamp%></td>
                      <td><%=history[i].nameE%></td>
                    </tr>                   
                    <% }
                  } %>
                </tbody>
              </table>
            </div>

          </div> 	 
        </div>
      </div>
    </div>
	</div>
  </section>

  <!-- Modal dialog -->
  <% if(request.length) {
    for(var i = 0;i < request.length;i++) { %>
    <div id="RequestModal<%=request[i].said%>" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3><center> Are You Sure? </center></h3>
          </div>
          <div class="modal-footer">
            <a class="btn btn-success" href="/servicemanage/delete/<%=request[i].said%>">Delete</a>
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div> 
    <% }         
    for(var i = 0;i < request.length;i++) { %>
    <div id="AcceptModal<%=request[i].said%>" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="/servicemanage/accept/<%=request[i].said%>" method="post">

            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h3><center>Confirmation</center></h3>
            </div>

            <div class="modal-body">
              <div class="form-group">
                <label> Source MAC Address: </label>
                <input type="text" class="form-control" placeholder="<%=request[i].resourceString1%>" disabled>
              </div>
              <div class="form-group">
                <label> Destination MAC Address: </label>
                <input type="text" class="form-control" placeholder="<%=request[i].resourceString2%>" disabled>
              </div>
              <div class="form-group">
                <label> Source IP Address: </label>
                <input type="text" class="form-control" placeholder="<%=request[i].IP1%>" disabled>
              </div>
              <div class="form-group">
                <label> Destination IP Address: </label>
                <input type="text" class="form-control" placeholder="<%=request[i].IP2%>" disabled>
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" class="btn btn-success" value="save">Accept</a>
              <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>    

          </form>
        </div>
      </div>
    </div> 
    <% }
  } %>

  <% if(approve.length){ 
    for(var i = 0;i < approve.length;i++) { %>
    <div id="ApproveCancelModal<%=approve[i].said%>" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3><center> Are You Sure? </center></h3>
          </div>
          <div class="modal-footer">
            <a class="btn btn-success" href="/servicemanage/deleteapprove/<%=approve[i].said%>">Delete</a>
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div> 
    <% }
  } %>

  

  <div class="modal fade" id="AddModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">          
        <form action="/addService" method="post" onsubmit="return checkForm(this);">

          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3><center> Add New Express </center></h3>
          </div>

          <div class="modal-body">
            <div id="alert" class="hide" role="alert"></div>
            <div class="form-group">
              <label>Source MAC Address</label>
              <input type="text" class="form-control" name="resourceString1ByAdmin"  id="resourceString1ByAdmin" placeholder="xx:xx:xx:xx:xx:xx" required="true">
            </div>

            <div class="form-group">
              <label>Destination MAC Address</label>
              <input type="text" class="form-control" name="resourceString2ByAdmin" id="resourceString2ByAdmin" placeholder="xx:xx:xx:xx:xx:xx" required="true">
            </div>

            <div class="form-group">
              <label>Source IP Address</label>
              <input type="text" class="form-control" name="IP1ByAdmin"  id="IP1ByAdmin" placeholder="x.x.x.x" required="true">
            </div>

            <div class="form-group">
              <label>Destination IP Address</label>
              <input type="text" class="form-control" name="IP2ByAdmin" id="IP2ByAdmin" placeholder="x.x.x.x" required="true">
            </div>

            <div class="form-group">
              <label>Duration of services</label>
              <div class="input-daterange" id="datePickerNewXL">
                <input type="text" style="text-align: center;" name="startTimeByAdmin" id="startTimeByAdmin" placeholder="YYYY/MM/DD hh:mm:ss" size="17" required="true">
                &nbsp;to&nbsp;
                <input type="text" style="text-align: center;" name="endTimeByAdmin" id="endTimeByAdmin" placeholder="YYYY/MM/DD hh:mm:ss" size="17" required="true">
                &nbsp;&nbsp;<span class="fa fa-calendar"></span>
              </div>
            </div> 
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-success btn-md" value="addService">Submit</button> 
            <button type="button" class="btn btn-danger btn-md" data-dismiss="modal">Cancel</button> 
          </div>

        </form>
      </div>
    </div>
  </div>

  <% if(active.length){ 
    for(var i = 0;i < active.length;i++) { %>
      <div id="EditActiveModal<%=active[i].apid%>" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <form action="/servicemanage/edit/<%=active[i].apid%>" method="post" onsubmit="return checkForm(this);">
              
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3><center> Edit Active Service </center></h3>
              </div>

              <div class="modal-body">  
                <div id="alert" class="hide" role="alert"></div>
                <div class="form-group">
                  <label>Source MAC Address</label>
                  <input type="text" class="form-control" name="resourceString1"  id="resourceString1" placeholder="resourceString1" value="<%=active[i].resourceString1%>" required="true">
                </div>

                <div class="form-group">
                  <label>Destination MAC Address</label>
                  <input type="text" class="form-control" name="resourceString2" id="resourceString2" placeholder="resourceString2" value="<%=active[i].resourceString2%>" required="true">
                </div>

                <div class="form-group">
                  <label>Source IP Address</label>
                  <input type="text" class="form-control" name="IP1"  id="IP1" placeholder="IP1" value="<%=active[i].IP1%>" required="true">
                </div>

                <div class="form-group">
                  <label>Destination IP Address</label>
                  <input type="text" class="form-control" name="IP2" id="IP2" placeholder="IP2" value="<%=active[i].IP2%>" required="true">
                </div>

                <div class="form-group">
                  <label>Duration of services</label>
                  <div class="input-daterange" id="datePickerEdit<%=i%>">
                    <input type="text" style="text-align: center;" name="startTime" id="startTime" value="<%=active[i].startTime %>" placeholder="YYYY/MM/DD hh:mm:ss" size="17" required="true">
                    &nbsp;to&nbsp;
                    <input type="text" style="text-align: center;" name="endTime" id="endTime" value="<%=active[i].endTime %>" placeholder="YYYY/MM/DD hh:mm:ss" size="17" required="true">
                    &nbsp;&nbsp;<span class="fa fa-calendar"></span>
                  </div>
                </div> 
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-success btn-md" value="editService">Submit</button> 
                <button type="button" class="btn btn-danger btn-md" data-dismiss="modal">Cancel</button> 
              </div>

            </form>
          </div>
        </div>
      </div>  
    <% }
    for(var i = 0;i < active.length;i++) { %>
      <div id="CancleActiveModal<%=active[i].apid%>" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h3><center> Are You Sure? </center></h3>
            </div>
            <div class="modal-footer">
              <a class="btn btn-success" href="/servicemanage/deleteactive/<%=active[i].apid%>">Delete</a>
              <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div> 
    <% }
  }%>
  <!-- End Modal dialog -->

  <footer id="footer">
    <div class="container">
      <div class="row">
        <%include ./footer %>
      </div>
    </div>
  </footer><!--/#footer-->
  
  <link href="css/daterangepicker.css" rel="stylesheet">

  <script src="js/moment.min.js"></script>
  <script src="js/daterangepicker.js"></script>
  <script type="text/javascript">
    var startTime;
    var endTime;
    var num_active = <%=active.length%>;
    $(document).ready(function($) {      
      $('#servicesrequest').dataTable({
          "pagingType": "full_numbers"
      });
      $('#servicesapprove').dataTable({
          "pagingType": "full_numbers"
      });
      $('#activeservices').dataTable({
          "pagingType": "full_numbers"
      });
      $('#statetable').dataTable({
          "pagingType": "full_numbers"
      });
      $('#historytable').dataTable({
          "pagingType": "full_numbers"
      });      
      $('#datePickerNewXL').daterangepicker({
        timePicker: true,
        timePicker24Hour: true,
          locale: {
              format: 'YYYY/MM/DD HH:mm:ss'
          }
        }, function(start, end) {
          $('#reportrange span').html(start.format('YYYY/MM/DD HH:mm:ss') + ' - ' + end.format('YYYY/MM/DD HH:mm:ss'));
          document.getElementById("startTimeByAdmin").value = start.format('YYYY/MM/DD HH:mm:ss');
          document.getElementById("endTimeByAdmin").value = end.format('YYYY/MM/DD HH:mm:ss');
        }
      ); 
      var item;
      for (var i = 0; i < num_active; i++) {
        item = '#datePickerEdit'+i;
        $(item).daterangepicker({
          timePicker: true,
          timePicker24Hour: true,
            locale: {
                format: 'YYYY/MM/DD HH:mm:ss'
            }
          }, function(start, end) {
            $('#reportrange span').html(start.format('YYYY/MM/DD HH:mm:ss') + ' - ' + end.format('YYYY/MM/DD HH:mm:ss'));
            document.getElementById("startTime").value = start.format('YYYY/MM/DD HH:mm:ss');
            document.getElementById("endTime").value = end.format('YYYY/MM/DD HH:mm:ss');
          }
        ); 
      }      
    });
  </script>

</body>
</html>